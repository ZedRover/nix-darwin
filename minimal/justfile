# è®¾ç½®é»˜è®¤ shell
set shell := ["bash", "-cu"]

# å¯é€‰ï¼šé»˜è®¤ä»»åŠ¡
default:
    just deploy

# æ›´æ–° flake & rebuild ç³»ç»Ÿ
deploy:
    # å¯é€‰ï¼šé‡Šæ”¾ nix store ç©ºé—´
    # nix store gc

    # echo "ğŸ”„ Updating flake..."
    # nix flake update

    echo "ğŸ”¨ Building system..."
    nix build .#darwinConfigurations.zeds.system \
        --extra-experimental-features 'nix-command flakes'

    echo "ğŸš€ Switching system configuration..."
    sudo ./result/sw/bin/darwin-rebuild switch --flake .#zeds
